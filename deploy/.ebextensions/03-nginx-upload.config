###################################################################################################
# 03-nginx-upload.config
# Configura Nginx para aceitar uploads grandes (50MB) e timeouts adequados
###################################################################################################

files:
  "/etc/nginx/conf.d/upload.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      client_max_body_size 50M;
      client_body_buffer_size 50M;
      client_body_timeout 300;
      client_header_timeout 300;
      keepalive_timeout 300;
      send_timeout 300;
      proxy_connect_timeout 300;
      proxy_send_timeout 300;
      proxy_read_timeout 300;
      
      # Buffer settings
      proxy_buffering off;
      proxy_request_buffering off;
      
  "/etc/nginx/conf.d/gzip.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      gzip on;
      gzip_comp_level 6;
      gzip_types text/plain text/css text/xml text/javascript 
                 application/json application/javascript application/xml+rss 
                 application/rss+xml application/atom+xml image/svg+xml 
                 text/x-js text/x-cross-domain-policy application/x-font-ttf 
                 application/x-font-opentype application/vnd.ms-fontobject 
                 image/x-icon;
      gzip_vary on;
      gzip_disable "msie6";

container_commands:
  01_reload_nginx:
    command: "sudo service nginx reload || true"